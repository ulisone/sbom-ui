<%# Summary Report Partial %>
<% content = report.content.with_indifferent_access %>
<% vuln_summary = content[:vulnerability_summary] || {} %>
<% dep_summary = content[:dependency_summary] || {} %>

<!-- Risk Score Overview -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
  <div class="card flex items-center gap-4">
    <div class="w-12 h-12 rounded-lg flex items-center justify-center <%= risk_score_bg_class(content[:risk_score]) %>">
      <span class="text-xl font-bold <%= risk_score_text_class(content[:risk_score]) %>"><%= content[:risk_score] || 0 %></span>
    </div>
    <div>
      <p class="text-text-secondary text-sm"><%= t('reports.labels.risk_score') %></p>
      <p class="text-text-primary font-medium"><%= t("reports.risk_levels.#{risk_level(content[:risk_score])}") %></p>
    </div>
  </div>

  <div class="card flex items-center gap-4">
    <div class="w-12 h-12 bg-critical-bg rounded-lg flex items-center justify-center">
      <span class="text-xl font-bold text-critical"><%= vuln_summary[:critical] || 0 %></span>
    </div>
    <div>
      <p class="text-text-secondary text-sm"><%= t('vulnerabilities.severity.critical') %></p>
      <p class="text-text-primary font-medium"><%= t('reports.labels.vulnerabilities') %></p>
    </div>
  </div>

  <div class="card flex items-center gap-4">
    <div class="w-12 h-12 bg-high-bg rounded-lg flex items-center justify-center">
      <span class="text-xl font-bold text-high"><%= vuln_summary[:high] || 0 %></span>
    </div>
    <div>
      <p class="text-text-secondary text-sm"><%= t('vulnerabilities.severity.high') %></p>
      <p class="text-text-primary font-medium"><%= t('reports.labels.vulnerabilities') %></p>
    </div>
  </div>

  <div class="card flex items-center gap-4">
    <div class="w-12 h-12 bg-primary-light rounded-lg flex items-center justify-center">
      <span class="text-xl font-bold text-primary"><%= dep_summary[:total] || 0 %></span>
    </div>
    <div>
      <p class="text-text-secondary text-sm"><%= t('scans.dependencies') %></p>
      <p class="text-text-primary font-medium"><%= t('reports.labels.total') %></p>
    </div>
  </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
  <!-- Vulnerability Summary -->
  <div class="card">
    <h3 class="text-lg font-semibold text-text-primary mb-4"><%= t('reports.sections.vulnerability_summary') %></h3>
    <div class="space-y-3">
      <div class="flex items-center justify-between">
        <span class="text-text-secondary"><%= t('reports.labels.total_vulnerabilities') %></span>
        <span class="text-text-primary font-medium"><%= vuln_summary[:total] || 0 %></span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-text-secondary"><%= t('reports.labels.with_fix') %></span>
        <span class="text-low font-medium"><%= vuln_summary[:with_fix] || 0 %></span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-text-secondary"><%= t('reports.labels.without_fix') %></span>
        <span class="text-medium font-medium"><%= vuln_summary[:without_fix] || 0 %></span>
      </div>
    </div>

    <!-- Severity Breakdown Chart -->
    <div class="mt-4 pt-4 border-t border-border">
      <div class="flex items-end gap-2 h-24">
        <% max_count = [vuln_summary[:critical], vuln_summary[:high], vuln_summary[:medium], vuln_summary[:low]].compact.max || 1 %>
        <div class="flex-1 flex flex-col items-center">
          <div class="w-full bg-critical rounded-t" style="height: <%= ((vuln_summary[:critical] || 0).to_f / max_count * 80).to_i %>px; min-height: 4px;"></div>
          <span class="text-xs text-text-muted mt-1">C</span>
        </div>
        <div class="flex-1 flex flex-col items-center">
          <div class="w-full bg-high rounded-t" style="height: <%= ((vuln_summary[:high] || 0).to_f / max_count * 80).to_i %>px; min-height: 4px;"></div>
          <span class="text-xs text-text-muted mt-1">H</span>
        </div>
        <div class="flex-1 flex flex-col items-center">
          <div class="w-full bg-medium rounded-t" style="height: <%= ((vuln_summary[:medium] || 0).to_f / max_count * 80).to_i %>px; min-height: 4px;"></div>
          <span class="text-xs text-text-muted mt-1">M</span>
        </div>
        <div class="flex-1 flex flex-col items-center">
          <div class="w-full bg-low rounded-t" style="height: <%= ((vuln_summary[:low] || 0).to_f / max_count * 80).to_i %>px; min-height: 4px;"></div>
          <span class="text-xs text-text-muted mt-1">L</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Dependency Summary -->
  <div class="card">
    <h3 class="text-lg font-semibold text-text-primary mb-4"><%= t('reports.sections.dependency_summary') %></h3>
    <div class="space-y-3">
      <div class="flex items-center justify-between">
        <span class="text-text-secondary"><%= t('reports.labels.total_dependencies') %></span>
        <span class="text-text-primary font-medium"><%= dep_summary[:total] || 0 %></span>
      </div>
      <div class="flex items-center justify-between">
        <span class="text-text-secondary"><%= t('reports.labels.unique_packages') %></span>
        <span class="text-text-primary font-medium"><%= dep_summary[:unique_packages] || 0 %></span>
      </div>
    </div>

    <% if dep_summary[:by_ecosystem].present? %>
      <div class="mt-4 pt-4 border-t border-border">
        <p class="text-sm text-text-secondary mb-2"><%= t('reports.labels.by_ecosystem') %></p>
        <div class="flex flex-wrap gap-2">
          <% dep_summary[:by_ecosystem].each do |ecosystem, count| %>
            <span class="badge bg-surface-hover text-text-primary"><%= ecosystem %>: <%= count %></span>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>

<!-- Top Vulnerabilities -->
<% if content[:top_vulnerabilities].present? %>
  <div class="card mb-6">
    <h3 class="text-lg font-semibold text-text-primary mb-4"><%= t('reports.sections.top_vulnerabilities') %></h3>
    <div class="space-y-3">
      <% content[:top_vulnerabilities].each do |vuln| %>
        <div class="p-4 bg-background rounded-lg border border-border">
          <div class="flex items-start justify-between">
            <div>
              <div class="flex items-center gap-2 mb-1">
                <span class="<%= severity_badge_class(vuln[:severity]) %>"><%= t("vulnerabilities.severity.#{vuln[:severity].to_s.downcase}") %></span>
                <span class="font-mono text-sm text-text-primary"><%= vuln[:cve_id] %></span>
              </div>
              <p class="text-text-primary"><%= vuln[:title] %></p>
              <p class="text-text-secondary text-sm mt-1"><%= t('vulnerabilities.labels.package') %>: <%= vuln[:package] %></p>
            </div>
            <div class="text-right">
              <% if vuln[:cvss_score] %>
                <span class="text-text-secondary text-sm">CVSS: <%= vuln[:cvss_score] %></span>
              <% end %>
              <% if vuln[:has_fix] %>
                <p class="text-low text-sm"><%= t('vulnerabilities.status.fix_available') %></p>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<!-- Recommendations -->
<% if content[:recommendations].present? %>
  <div class="card">
    <h3 class="text-lg font-semibold text-text-primary mb-4"><%= t('reports.sections.recommendations') %></h3>
    <div class="space-y-4">
      <% content[:recommendations].each_with_index do |rec, index| %>
        <div class="flex gap-4">
          <div class="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center <%= recommendation_priority_class(rec[:priority]) %>">
            <%= index + 1 %>
          </div>
          <div>
            <h4 class="font-medium text-text-primary"><%= rec[:title] %></h4>
            <p class="text-text-secondary text-sm mt-1"><%= rec[:description] %></p>
            <% if rec[:packages].present? %>
              <div class="flex flex-wrap gap-1 mt-2">
                <% rec[:packages].first(3).each do |pkg| %>
                  <span class="text-xs bg-surface-hover text-text-secondary px-2 py-1 rounded"><%= pkg.is_a?(Array) ? pkg.first : pkg %></span>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
